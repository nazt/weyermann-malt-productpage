# PocketBase 5-Agent Parallel Orchestration

**Time**: 13:59 GMT+7

## What We Learned

- **5 agents can work in true parallel** - Send tasks to all 5 simultaneously via tmux, wait for signal files
- **Claude faster for design tasks** (~30s) vs Codex for implementation (~2-3min)
- **Signal files are reliable** - `.tmp/agent{N}-done` pattern works across agents/windows
- **PocketBase as communication hub** - SQLite-backed inbox scales better than file-based
- **Go endpoints follow consistent patterns** - loggingResponse wrapper + dbx.Params for all routes

## How Things Connect

- **tmux panes → agent worktrees**: Window 1 (1.1, 1.2, 1.3) → agents/1,2,3; Window 2 (2.1, 2.2) → agents/4,5
- **PocketBase collections → agent state**: `agent_status` for registration, `inbox` for messages
- **Registration → Heartbeat → Task Queue**: Each phase builds on previous endpoints
- **Claude designs → Codex implements**: Natural division of labor by model strength

## Key Discoveries

- **Agent 1 (Claude) needs "push"** - Sometimes waits at prompt, Enter key triggers execution
- **Codex can disconnect mid-task** - "stream disconnected before completion" - need retry logic
- **62KB output from 20 tasks** - High productivity when properly orchestrated
- **upsert pattern essential** - `FindFirstRecordByFilter` + `NewRecord` fallback for idempotent registration

## Architecture Pattern

```
Orchestrator (me)
    ↓ tmux send-keys
5 Agent Panes (parallel)
    ↓ contributions/*.{md,go,sh}
Signal Files (.tmp/agent{N}-done)
    ↓ detection loop
Result Collection
```

## Commits
- Session work not yet committed (in agents/* worktrees)

## Tags
`pocketbase` `multi-agent` `parallel-execution` `tmux` `codex` `claude` `5-agent` `task-distribution`

## Raw Thoughts

- Could pre-warm agents with `/compact` to clear context before task
- Need heartbeat daemon to detect agent crashes
- SSE would eliminate polling for real-time updates
- Consider task queue with priority for load balancing
- Codex disconnect issue needs investigation - rate limit? network?
- 85% completion rate is good but want 100% - retry mechanism needed
